<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/me417/libs/katex/katex.min.css"> <link rel=stylesheet  href="/me417/libs/highlight/github.min.css"> <link rel=stylesheet  href="/me417/css/franklin.css"> <link rel=stylesheet  href="/me417/css/poole_hyde.css"> <link rel=stylesheet  href="/me417/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 968px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/me417/assets/c.svg"> <title>Numerical Integration - PID Controller</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <br> <img src="/me417/assets/KuwaitUniversityLogoTextLight.svg" style="width: 200px; height: auto; display: inline"> <h1 style="font-size:2em; opacity: 0.75;"><a href="/me417/">ME 417</a></h1> <p class=lead >Control of Mechanical Systems</p> </div> <script> function hidePart(part_div) { var x = document.getElementById(part_div); if (x.style.display === "none") { x.style.display = "block"; } else { x.style.display = "none"; } } </script> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/me417/">Home</a> <a class="sidebar-nav-item " href="/me417/videos/">Lecture Videos</a> <a class="sidebar-nav-item active" href="/me417/numerical_lessons/">Numerical Lessons</a> <a class="sidebar-nav-item " href="/me417/numerical_assignments/">Numerical Assignments</a> <a class="sidebar-nav-item " href="/me417/homeworks/">Homeworks</a> <br> <small style="text-transform: uppercase; font-size: 0.75em">Class Lectures</small> <div class=part  onclick="hidePart('part1_div')">I Introduction</div> <div id=part1_div  style="display:none;"> <a class="sidebar-nav-item " href="/me417/part_i/lecture1/"><b>L1</b> - <em>Introduction</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture2/"><b>L2</b> - <em>Analysis and Design</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture3/"><b>L3</b> - <em>Transfer Function</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture4/"><b>L4</b> - <em>Mechanical Systems</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture5/"><b>L5</b> - <em>Electromechanical Systems</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture6/"><b>L6</b> - <em>Poles Zeros and System Response</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture7/"><b>L7</b> - <em>The General Second-Order System</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture8/"><b>L8</b> - <em>Introduction to Stability and Feedback Control</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture9/"><b>L9</b> - <em>PID Control via Gain Tuning</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture10/"><b>L10</b> - <em>Steady-State Error</em></a> <a class="sidebar-nav-item " href="/me417/part_i/lecture11/"><b>L11</b> - <em>Unity Feedback Controller Design</em></a> </div> <div class=part  onclick="hidePart('part2_div')">II Root-Locus</div> <div id=part2_div  style="display:none;"> <a class="sidebar-nav-item " href="/me417/part_ii/lecture1/"><b>L1</b> - <em>Introduction to Root-Locus</em></a> <a class="sidebar-nav-item " href="/me417/part_ii/lecture2/"><b>L2</b> - <em>Sketching the Root-Locus</em></a> <a class="sidebar-nav-item " href="/me417/part_ii/lecture3/"><b>L3</b> - <em>Transient Response Design via Gain Adjustment</em></a> <a class="sidebar-nav-item " href="/me417/part_ii/lecture4/"><b>L4</b> - <em>Improving Steady-State Response</em></a> <a class="sidebar-nav-item " href="/me417/part_ii/lecture5/"><b>L5</b> - <em>Improving Transient Response</em></a> <a class="sidebar-nav-item " href="/me417/part_ii/lecture6/"><b>L6</b> - <em>Improving Overall Response</em></a> </div> <div class=part  onclick="hidePart('part3_div')">III State-Space</div> <div id=part3_div  style="display:none;"> <a class="sidebar-nav-item " href="/me417/part_iii/lecture1/"><b>L1</b> - <em>State-Space Representation</em></a> <a class="sidebar-nav-item " href="/me417/part_iii/lecture2/"><b>L2</b> - <em>Stability and Steady-State Error in State-Space</em></a> <a class="sidebar-nav-item " href="/me417/part_iii/lecture3/"><b>L3</b> - <em>State-Space Controller Representation and Design</em></a> <a class="sidebar-nav-item " href="/me417/part_iii/lecture4/"><b>L4</b> - <em>Introduction to Linear Optimal Control</em></a> <a class="sidebar-nav-item " href="/me417/part_iii/lecture5/"><b>L5</b> - <em>State-Space Controller Design Problems</em></a> </div> <div class=part  onclick="hidePart('part4_div')">IV Frequency Response</div> <div id=part4_div  style="display:none;"> <a class="sidebar-nav-item " href="/me417/part_iv/lecture1/"><b>L1</b> - <em>Introduction to Frequency Response</em></a> <a class="sidebar-nav-item " href="/me417/part_iv/lecture2/"><b>L2</b> - <em>Sketching Bode Plots</em></a> <a class="sidebar-nav-item " href="/me417/part_iv/lecture3/"><b>L3</b> - <em>Refining Second Order Systems Bode Plots</em></a> <a class="sidebar-nav-item " href="/me417/part_iv/lecture4/"><b>L4</b> - <em>System Identification from Frequnecy Response</em></a> <a class="sidebar-nav-item " href="/me417/part_iv/lecture5/"><b>L5</b> - <em>Stability in Frequency Response</em></a> </div> </nav> <p>&copy; Ali AlSaibie, PhD.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=implementing_a_pid_controller_in_numerical_integration_simulation ><a href="#implementing_a_pid_controller_in_numerical_integration_simulation" class=header-anchor >Implementing a PID Controller in Numerical Integration Simulation</a></h1> <p>This note explains how to simulate the closed-loop response of a system that has a zero with a PID controller, using basic numerical integration. </p> <p>Consider the following system, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>p</mi></msub><mo>=</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mn>3</mn><mo stretchy=false >(</mo><mi>s</mi><mo>+</mo><mn>3</mn><mo stretchy=false >)</mo></mrow><mrow><msup><mi>s</mi><mn>2</mn></msup><mo>+</mo><mn>3</mn><mi>s</mi><mo>+</mo><mn>15</mn></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">G_p=\dfrac{3(s+3)}{s^2+3s+15}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.19633em;vertical-align:-0.7693300000000001em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >3</span><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >1</span><span class=mord >5</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >3</span><span class=mopen >(</span><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >3</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>, for which we want to apply the controller <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>c</mi></msub><mo>=</mo><mn>0.007</mn><mo stretchy=false >(</mo><mi>s</mi><mo>+</mo><mn>20</mn><mo stretchy=false >)</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi>s</mi><mo>+</mo><mn>6</mn></mrow><mi>s</mi></mfrac></mstyle></mrow><annotation encoding="application/x-tex">G_c=0.007(s+20)\dfrac{s+6}{s}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span><span class=mord >0</span><span class=mord >7</span><span class=mopen >(</span><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.00744em;vertical-align:-0.686em;"></span><span class=mord >2</span><span class=mord >0</span><span class=mclose >)</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">s</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >6</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> in unity feedback.</p> <p>If we want to simulate the closed-loop response to a step input, using the built-in functions, we can compute the direct closed-loop transfer function. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mrow><mi>c</mi><mi>l</mi></mrow></msub><mo>=</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><msub><mi>G</mi><mi>c</mi></msub><msub><mi>G</mi><mi>p</mi></msub></mrow><mrow><mn>1</mn><mo>+</mo><msub><mi>G</mi><mi>c</mi></msub><msub><mi>G</mi><mi>p</mi></msub></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">G_{cl}=\dfrac{G_cG_p}{1+G_cG_p}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.332438em;vertical-align:-0.972108em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p> <p>Then we can directly use the <code>step&#40;&#41;</code> response function.</p> <pre><code class="matlab hljs">s = tf(<span class=hljs-string >&quot;s&quot;</span>)
Gp = <span class=hljs-number >3</span>*(s+<span class=hljs-number >3</span>) / (s^<span class=hljs-number >2</span>+<span class=hljs-number >3</span>*s+<span class=hljs-number >15</span>)
Gc = <span class=hljs-number >0.007</span>*(s+<span class=hljs-number >20</span>)*(s+<span class=hljs-number >6</span>)/s
Gcl = feedback(Gc*Gp, <span class=hljs-number >1</span>)
<span class=hljs-built_in >figure</span>()
step(Gcl)</code></pre> <pre><code class="julia hljs">s =
  
      s
     
    Continuous-time transfer <span class=hljs-keyword >function</span>.
    
    
    Gp =
     
         <span class=hljs-number >3</span> s + <span class=hljs-number >9</span>
      --------------
      s^<span class=hljs-number >2</span> + <span class=hljs-number >3</span> s + <span class=hljs-number >15</span>
     
    Continuous-time transfer <span class=hljs-keyword >function</span>.
    
    
    Gc =
     
      <span class=hljs-number >0.007</span> s^<span class=hljs-number >2</span> + <span class=hljs-number >0.182</span> s + <span class=hljs-number >0.84</span>
      --------------------------
                  s
     
    Continuous-time transfer <span class=hljs-keyword >function</span>.
    
    
    Gcl =
     
      <span class=hljs-number >0.021</span> s^<span class=hljs-number >3</span> + <span class=hljs-number >0.609</span> s^<span class=hljs-number >2</span> + <span class=hljs-number >4.158</span> s + <span class=hljs-number >7.56</span>
      --------------------------------------
      <span class=hljs-number >1.021</span> s^<span class=hljs-number >3</span> + <span class=hljs-number >3.609</span> s^<span class=hljs-number >2</span> + <span class=hljs-number >19.16</span> s + <span class=hljs-number >7.56</span>
     
    Continuous-time transfer <span class=hljs-keyword >function</span>.</code></pre> <center><img src="/me417/assets/numerical_lessons_matlab/Numerical_Simulation_PID_Controller/media/output_1_1.png" style="max-width:780px"></center> <h2 id=pid_controller_-_continuous_form ><a href="#pid_controller_-_continuous_form" class=header-anchor >PID Controller - Continuous Form</a></h2> <p>But we want to simulate the response through basic numerical integration. Let&#39;s look at the PID control law</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>u</mi><mo stretchy=false >(</mo><mi>t</mi><mo stretchy=false >)</mo><mo>=</mo><msub><mi>K</mi><mi>P</mi></msub><mi>e</mi><mo stretchy=false >(</mo><mi>t</mi><mo stretchy=false >)</mo><mo>+</mo><msub><mi>K</mi><mi>I</mi></msub><mo>∫</mo><mrow><mi>e</mi><mo stretchy=false >(</mo><mi>t</mi><mo stretchy=false >)</mo><mi>d</mi><mi>t</mi></mrow><mo>+</mo><msub><mi>K</mi><mi>D</mi></msub><mover accent=true ><mi>e</mi><mo>˙</mo></mover><mo stretchy=false >(</mo><mi>t</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> u(t)=K_P e(t) + K_I \int{e(t)dt} + K_D \dot{e}(t) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class=mopen >(</span><span class="mord mathnormal">t</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">e</span><span class=mopen >(</span><span class="mord mathnormal">t</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.22225em;vertical-align:-0.86225em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">∫</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal">e</span><span class=mopen >(</span><span class="mord mathnormal">t</span><span class=mclose >)</span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">e</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.08333000000000002em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal">t</span><span class=mclose >)</span></span></span></span></span> <p>And in code form</p> <pre><code class="matlab hljs">u[idx] = Kp*e[idx] + Ki*eint[idx] + Kd*edot[idx]</code></pre>
<p>We can find the integral and derivative of the error by numerical integration and differentiation respectively, this is really a discrete controller, it will not produce the same response as we got with <code>step&#40;&#41;</code>, but will be close if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\Delta t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >Δ</span><span class="mord mathnormal">t</span></span></span></span> is sufficiently small.</p>
<p>To find the error, error integral and error derivative numerically, where <code>r</code> is the reference and <code>y</code> is the output of the system, and <code>dt</code> is the time sample of the simulation. We can do the following</p>
<pre><code class="matlab hljs">e[idx] = r[idx] - y[idx]
eint[idx] = eint[idx<span class=hljs-number >-1</span>]+ e[idx] * dt;
edot[idx] = (e[idx] - e[idx <span class=hljs-number >-1</span>]) / dt;</code></pre>
<p>Note that on the first iteration, we can not access a negative index, so you can keep <code>eint&#91;1&#93;&#61;e&#91;1&#93;*dt</code> and <code>edot&#91;1&#93;&#61;0</code>, then apply the above rules for <code>idx&gt;1</code></p>
<h2 id=simulating_a_system_response_with_a_zero ><a href="#simulating_a_system_response_with_a_zero" class=header-anchor >Simulating a system response with a zero</a></h2>
<p>Converting the transfer function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo stretchy=false >(</mo><mi>s</mi><mo stretchy=false >)</mo><mo>=</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mi>Y</mi><mi>U</mi></mfrac></mstyle><mo>=</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mn>2</mn><mo stretchy=false >(</mo><mi>s</mi><mo>+</mo><mn>30</mn><mo stretchy=false >)</mo></mrow><mrow><msup><mi>s</mi><mn>2</mn></msup><mo>+</mo><mn>4</mn><mi>s</mi><mo>+</mo><mn>20</mn></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">G(s)=\dfrac{Y}{U}=\dfrac{2(s+30)}{s^2+4s+20}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class=mopen >(</span><span class="mord mathnormal">s</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.19633em;vertical-align:-0.7693300000000001em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >4</span><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >2</span><span class=mord >0</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span><span class=mopen >(</span><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >3</span><span class=mord >0</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> to a differential equation, we get <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>y</mi><mo>¨</mo></mover><mo>+</mo><mn>3</mn><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mo>+</mo><mn>15</mn><mi>y</mi><mo>=</mo><mn>3</mn><mover accent=true ><mi>u</mi><mo>˙</mo></mover><mo>+</mo><mn>9</mn><mi>u</mi></mrow><annotation encoding="application/x-tex">\ddot{y}+3\dot{y}+15y=3\dot{u}+9u</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >¨</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class=mord >3</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.08333000000000002em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >1</span><span class=mord >5</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.75119em;vertical-align:-0.08333em;"></span><span class=mord >3</span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">u</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.11111000000000001em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >9</span><span class="mord mathnormal">u</span></span></span></span>. This is a second order system, and to express it as a state-space vector model, we require two states. </p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mover accent=true ><mi mathvariant=bold >x</mi><mo>˙</mo></mover><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.15999999999999992em  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mover accent=true ><mi>y</mi><mo>˙</mo></mover></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mover accent=true ><mi>y</mi><mo>¨</mo></mover></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.15999999999999992em  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mover accent=true ><mi>y</mi><mo>˙</mo></mover></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mo>−</mo><mn>3</mn><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mo>−</mo><mn>9</mn><mi>y</mi><mo>+</mo><mn>3</mn><mover accent=true ><mi>u</mi><mo>˙</mo></mover><mo>+</mo><mn>9</mn><mi>u</mi></mrow></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.15999999999999992em  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>x</mi><mn>2</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mo>−</mo><mn>3</mn><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><mn>9</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mn>3</mn><mover accent=true ><mi>u</mi><mo>˙</mo></mover><mo>+</mo><mn>9</mn><mi>u</mi></mrow></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow></mrow><annotation encoding="application/x-tex">
\dot{\mathbf{x}}=\begin{bmatrix}\dot{y} \\ \ddot{y}\end{bmatrix}=\begin{bmatrix}\dot{y} \\ -3\dot{y}-9y+3\dot{u}+9u\end{bmatrix}=\begin{bmatrix}x_2 \\ -3x_2-9x_1+3\dot{u}+9u\end{bmatrix}
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6813em;vertical-align:0em;"></span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6813em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">x</span></span></span></span><span style="top:-3.01344em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.11111000000000001em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.08333000000000002em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.19444em;"><span class=mord >¨</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.08333000000000002em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >−</span><span class=mord >3</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.08333000000000002em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.19444em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >9</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >3</span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">u</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.11111000000000001em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >9</span><span class="mord mathnormal">u</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >−</span><span class=mord >3</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >9</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >3</span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">u</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.11111000000000001em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >9</span><span class="mord mathnormal">u</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span>
<p>But note that to implement it numerically, we would have to differentiate the input signal. A better approach is to separate the zeros of the plant transfer function, and rather than differentiate the input, scale the state by the numerator to produce the output &#40;no differentiation necessary&#41;. Note that the plant can be separated as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>p</mi></msub><mo>=</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mi>Y</mi><mi>U</mi></mfrac></mstyle><mo>=</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mi>Y</mi><mi>X</mi></mfrac></mstyle><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mi>X</mi><mi>U</mi></mfrac></mstyle><mo>=</mo><mo stretchy=false >(</mo><mn>3</mn><mi>s</mi><mo>+</mo><mn>9</mn><mo stretchy=false >)</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mn>1</mn><mrow><msup><mi>s</mi><mn>2</mn></msup><mo>+</mo><mn>3</mn><mi>s</mi><mo>+</mo><mn>9</mn></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">G_p=\dfrac{Y}{U}=\dfrac{Y}{X}\dfrac{X}{U}=(3s+9)\dfrac{1}{s^2+3s+9}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord >3</span><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class=mord >9</span><span class=mclose >)</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >3</span><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >9</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>, we can convert each of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mi>X</mi><mi>U</mi></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{X}{U}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mi>Y</mi><mi>X</mi></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{Y}{X}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> into a differential equation and we get: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent=true ><mi>x</mi><mo>¨</mo></mover><mo>+</mo><mn>3</mn><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mo>+</mo><mn>15</mn><mi>x</mi><mo>=</mo><mi>u</mi></mrow><annotation encoding="application/x-tex">\ddot{x}+3\dot{x}+15x=u</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.75119em;vertical-align:-0.08333em;"></span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">x</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.22222em;"><span class=mord >¨</span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.75119em;vertical-align:-0.08333em;"></span><span class=mord >3</span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">x</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.11111000000000001em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span><span class=mord >5</span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">u</span></span></span></span>, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>3</mn><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mo>+</mo><mn>9</mn><mi>x</mi></mrow><annotation encoding="application/x-tex">y=3\dot{x}+9x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.75119em;vertical-align:-0.08333em;"></span><span class=mord >3</span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">x</span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.11111000000000001em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >9</span><span class="mord mathnormal">x</span></span></span></span>. Expressed numerically.</p>
<pre><code class="matlab hljs">dxdt=@(t,x,u) [x(<span class=hljs-number >2</span>); (<span class=hljs-number >-3</span>*x(<span class=hljs-number >2</span>)<span class=hljs-number >-15</span>*x(<span class=hljs-number >1</span>)+u)];</code></pre>
<p>Where </p>
<pre><code class="matlab hljs">y[idx] = <span class=hljs-number >3</span>*xdot[idx]+<span class=hljs-number >9</span>*x[idx];</code></pre>
<pre><code class="matlab hljs">e[idx] = r[idx] - y[idx]
eint[idx] = eint[idx<span class=hljs-number >-1</span>]+ e[idx] * dt;
edot[idx] = (e[idx] - e[idx <span class=hljs-number >-1</span>]) / dt;</code></pre>
<pre><code class="matlab hljs">u[idx] = Kp*e[idx] + Ki*eint[idx] + Kd*edot[idx]</code></pre>
<p>And there is no need to differentiate the input signal now. </p>
<p>Let&#39;s see how all this can be simulated. Note that the PID controller gains are <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>P</mi></msub><mo>=</mo><mi mathvariant=normal >.</mi><mn>182</mn><mo separator=true >,</mo><msub><mi>K</mi><mi>D</mi></msub><mo>=</mo><mn>0.007</mn><mo separator=true >,</mo><msub><mi>K</mi><mi>I</mi></msub><mo>=</mo><mn>0.84</mn></mrow><annotation encoding="application/x-tex">K_P=.182, K_D=0.007, K_I=0.84</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord >.</span><span class=mord >1</span><span class=mord >8</span><span class=mord >2</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span><span class=mord >0</span><span class=mord >7</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >8</span><span class=mord >4</span></span></span></span></p>
<pre><code class="matlab hljs">dxdt=@(t,x,u) [x(<span class=hljs-number >2</span>); (<span class=hljs-number >-3</span>*x(<span class=hljs-number >2</span>)<span class=hljs-number >-15</span>*x(<span class=hljs-number >1</span>)+u)];

<span class=hljs-comment >% Integration time-step</span>
dt = <span class=hljs-number >0.01</span>;

<span class=hljs-comment >% Time vector</span>
t = <span class=hljs-number >0</span>:dt:<span class=hljs-number >20</span>;

<span class=hljs-comment >% Initialize Simulation Vectors</span>
x = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >2</span>, <span class=hljs-built_in >length</span>(t));
y = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >1</span>, <span class=hljs-built_in >length</span>(t));
u = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >1</span>, <span class=hljs-built_in >length</span>(t));
e = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >1</span>, <span class=hljs-built_in >length</span>(t));
edot = e; 
eint = e;

<span class=hljs-comment >% Initial Condition - Explicit Declaration</span>
x0 = [<span class=hljs-number >0</span>; <span class=hljs-number >0</span>];
x(:,<span class=hljs-number >1</span>) = x0;

<span class=hljs-comment >% Controller Gains</span>
Kp=<span class=hljs-number >.182</span>; Kd = <span class=hljs-number >0.007</span>; Ki=<span class=hljs-number >0.84</span>;

<span class=hljs-comment >% Step Input r = 1</span>
r = <span class=hljs-number >1</span>;

<span class=hljs-comment >% Simulate </span>
<span class=hljs-keyword >for</span> idx = <span class=hljs-number >1</span>:<span class=hljs-built_in >length</span>(t)
    e(<span class=hljs-number >1</span>, idx)   = r - y(<span class=hljs-number >1</span>,idx);
    <span class=hljs-keyword >if</span> idx == <span class=hljs-number >1</span>
        eint(<span class=hljs-number >1</span>,idx) = e(<span class=hljs-number >1</span>,idx) * dt; <span class=hljs-comment >% Forward Integration</span>
        edot(<span class=hljs-number >1</span>,idx) = <span class=hljs-number >0</span>; <span class=hljs-comment >% Skip on first iteration        </span>
    <span class=hljs-keyword >else</span>
        eint(<span class=hljs-number >1</span>,idx) = eint(<span class=hljs-number >1</span>,idx<span class=hljs-number >-1</span>) + e(<span class=hljs-number >1</span>,idx) * dt;
        edot(<span class=hljs-number >1</span>,idx) = (e(<span class=hljs-number >1</span>,idx) - e(<span class=hljs-number >1</span>, idx<span class=hljs-number >-1</span>)) / dt;
    <span class=hljs-keyword >end</span>
    u(<span class=hljs-number >1</span>,idx) = Kp*e(<span class=hljs-number >1</span>,idx) + Ki*eint(<span class=hljs-number >1</span>,idx) + Kd*edot(<span class=hljs-number >1</span>,idx);
    xdot = dxdt(t(<span class=hljs-number >1</span>, idx), x(:,idx), u(<span class=hljs-number >1</span>,idx));

    <span class=hljs-comment >% Integrate state</span>
    <span class=hljs-keyword >if</span>(idx &lt; <span class=hljs-built_in >length</span>(t))
        x(:,idx+<span class=hljs-number >1</span>) = x(:,idx) + xdot.*dt;
        <span class=hljs-comment >% Scale output</span>
        y(<span class=hljs-number >1</span>, idx+<span class=hljs-number >1</span>) = <span class=hljs-number >9</span>*x(<span class=hljs-number >1</span>,idx+<span class=hljs-number >1</span>)+<span class=hljs-number >3</span>*x(<span class=hljs-number >2</span>,idx+<span class=hljs-number >1</span>);
    <span class=hljs-keyword >end</span>
     
<span class=hljs-keyword >end</span>

<span class=hljs-built_in >figure</span>()
step(Gcl)
<span class=hljs-built_in >hold</span> on
<span class=hljs-built_in >plot</span>(t(<span class=hljs-number >1</span>,<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>),y(<span class=hljs-number >1</span>,<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>), <span class=hljs-string >&#x27;:&#x27;</span>)</code></pre>

<center><img src="/me417/assets/numerical_lessons_matlab/Numerical_Simulation_PID_Controller/media/output_3_1.png" style="max-width:780px"></center>

<h2 id=pid_controller_-_discrete_form ><a href="#pid_controller_-_discrete_form" class=header-anchor >PID Controller - Discrete Form</a></h2>
<p>A numerical integration simulation is a discrete system simulation, and converges into a continuous system for small <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\Delta t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >Δ</span><span class="mord mathnormal">t</span></span></span></span>, in addition, differentiating signal boundaries results in errors, and basic numerical integration is insufficient. </p>
<p>Given a continous form PID controller <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>c</mi></msub><mo>=</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><msub><mi>K</mi><mi>D</mi></msub><msup><mi>s</mi><mn>2</mn></msup><mo>+</mo><msub><mi>K</mi><mi>P</mi></msub><mi>s</mi><mo>+</mo><msub><mi>K</mi><mi>I</mi></msub></mrow><mi>s</mi></mfrac></mstyle></mrow><annotation encoding="application/x-tex">G_c=\dfrac{K_Ds^2+K_Ps+K_I}{s}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">G</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.177108em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">s</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>, we can convert it into a discrete form then derive the difference equation. This is outside the scope of this class, but here is the difference equation form of a PID controller. </p>
<pre><code class="matlab hljs">u[k]=u[k<span class=hljs-number >-1</span>] + a*e[idx] + b*e[idx<span class=hljs-number >-1</span>] + c*e[idx<span class=hljs-number >-1</span>]</code></pre>
<p>where</p>
<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><msub><mi>K</mi><mi>P</mi></msub><mo>+</mo><msub><mi>K</mi><mi>I</mi></msub><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi>d</mi><mi>t</mi></mrow><mn>2</mn></mfrac></mstyle><mo>+</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><msub><mi>K</mi><mi>D</mi></msub><mrow><mi mathvariant=normal >Δ</mi><mi>t</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">a = K_P+K_I\dfrac{dt}{2} + \dfrac{K_D}{\Delta t}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.05744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >Δ</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>
<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mo>−</mo><mi>K</mi><mi>p</mi><mo>+</mo><msub><mi>K</mi><mi>I</mi></msub><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >Δ</mi><mi>t</mi></mrow><mn>2</mn></mfrac></mstyle><mo>−</mo><mn>2</mn><mstyle displaystyle=true  scriptlevel=0 ><mfrac><msub><mi>K</mi><mi>D</mi></msub><mrow><mi mathvariant=normal >Δ</mi><mi>t</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">b=-Kp + K_I \dfrac{\Delta t}{2} -2\dfrac{K_D}{\Delta t}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal">p</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >Δ</span><span class="mord mathnormal">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord >2</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >Δ</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>
<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mstyle displaystyle=true  scriptlevel=0 ><mfrac><msub><mi>K</mi><mi>D</mi></msub><mrow><mi mathvariant=normal >Δ</mi><mi>t</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">c=\dfrac{K_D}{\Delta t}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >Δ</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>
<p>Note that the discrete PID gains are a function of the continous PID gains in addition to the sampling &#40;integration&#41; time-step. </p>
<p>Let&#39;s substitute this in the simulation setup and see if it works.</p>
<pre><code class="matlab hljs">dxdt=@(t,x,u) [x(<span class=hljs-number >2</span>); (<span class=hljs-number >-3</span>*x(<span class=hljs-number >2</span>)<span class=hljs-number >-15</span>*x(<span class=hljs-number >1</span>)+u)];

<span class=hljs-comment >% Integration time-step</span>
dt = <span class=hljs-number >0.01</span>;

<span class=hljs-comment >% Time vector</span>
t = <span class=hljs-number >0</span>:dt:<span class=hljs-number >20</span>;

<span class=hljs-comment >% Initialize Simulation Vectors</span>
x = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >2</span>, <span class=hljs-built_in >length</span>(t));
y = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >1</span>, <span class=hljs-built_in >length</span>(t));
u = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >1</span>, <span class=hljs-built_in >length</span>(t));
e = <span class=hljs-built_in >zeros</span>(<span class=hljs-number >1</span>, <span class=hljs-built_in >length</span>(t));

<span class=hljs-comment >% Initial Condition - Explicit Declaration</span>
x0 = [<span class=hljs-number >0</span>; <span class=hljs-number >0</span>];
x(:,<span class=hljs-number >1</span>) = x0;

<span class=hljs-comment >% Controller Gains</span>
Kp=<span class=hljs-number >.182</span>; Kd = <span class=hljs-number >0.007</span>; Ki=<span class=hljs-number >0.84</span>;
<span class=hljs-comment >% Discrete controller gains</span>
a = Kp + Ki * dt / <span class=hljs-number >2</span> + Kd / dt;
b = -Kp + Ki * dt / <span class=hljs-number >2</span> - <span class=hljs-number >2</span> * Kd / dt;
c = Kd/dt;

<span class=hljs-comment >% Step Input r = 1</span>
r = <span class=hljs-number >1</span>;

<span class=hljs-comment >% Simulate </span>
<span class=hljs-keyword >for</span> idx = <span class=hljs-number >1</span>:<span class=hljs-built_in >length</span>(t)
    e(<span class=hljs-number >1</span>, idx)   = r - y(<span class=hljs-number >1</span>,idx);
    <span class=hljs-keyword >if</span> idx &gt; <span class=hljs-number >2</span>
        u(<span class=hljs-number >1</span>,idx) = u(<span class=hljs-number >1</span>,idx<span class=hljs-number >-1</span>) + a*e(<span class=hljs-number >1</span>,idx) +b*e(<span class=hljs-number >1</span>,idx<span class=hljs-number >-1</span>) + c*e(<span class=hljs-number >1</span>,idx<span class=hljs-number >-2</span>);
    <span class=hljs-keyword >elseif</span> idx == <span class=hljs-number >2</span>
        u(<span class=hljs-number >1</span>,idx) = u(<span class=hljs-number >1</span>,idx<span class=hljs-number >-1</span>) + a*e(<span class=hljs-number >1</span>,idx) +b*e(<span class=hljs-number >1</span>,idx<span class=hljs-number >-1</span>);
    <span class=hljs-keyword >elseif</span> idx == <span class=hljs-number >1</span>
        u(<span class=hljs-number >1</span>,idx) = a*e(<span class=hljs-number >1</span>,idx); 
    <span class=hljs-keyword >end</span>
    xdot = dxdt(t(<span class=hljs-number >1</span>, idx), x(:,idx), u(<span class=hljs-number >1</span>,idx));
    <span class=hljs-comment >% Integrate state</span>
    <span class=hljs-keyword >if</span>(idx &lt; <span class=hljs-built_in >length</span>(t))
        x(:,idx+<span class=hljs-number >1</span>) = x(:,idx) + xdot*dt;
        <span class=hljs-comment >% Scale output</span>
        y(<span class=hljs-number >1</span>, idx+<span class=hljs-number >1</span>) = <span class=hljs-number >9</span>*x(<span class=hljs-number >1</span>,idx+<span class=hljs-number >1</span>)+<span class=hljs-number >3</span>*x(<span class=hljs-number >2</span>,idx+<span class=hljs-number >1</span>);
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>
<span class=hljs-built_in >plot</span>(t(<span class=hljs-number >1</span>,<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>),y(<span class=hljs-number >1</span>,<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>), <span class=hljs-string >&#x27;.-&#x27;</span>)</code></pre>

<center><img src="/me417/assets/numerical_lessons_matlab/Numerical_Simulation_PID_Controller/media/output_5_1.png" style="max-width:780px"></center>

<div class=page-foot >
  <div class=copyright >
    &copy; Ali AlSaibie, PhD. Last modified: June 06, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div>